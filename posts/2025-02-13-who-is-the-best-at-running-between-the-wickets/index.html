<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-13">

<title>Bradley Fern - Who is the best at running between the wickets?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.28/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Bradley Fern</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/bradfern_"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/bradley-fern-a10a6bab/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bfern"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Who is the best at running between the wickets?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">cricket</div>
                <div class="quarto-category">data science</div>
                <div class="quarto-category">r</div>
                <div class="quarto-category">visualisation</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 13, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Over the past few months, I’ve taken an interest in baseball analytics because there is so much cricket can learn from what has been done there. I’ve learnt that base running is a large component of the game, which struck me as odd since running between the wickets is neglected in cricket. But should it be? In this post, I will quantify the effect that a strong runner between the wickets has upon the team.</p>
<p>To do this, I am going to use wagonwheel data of where a batter hits the ball and how many runs they end up scoring. I will then build a model that predicts the number of runs they are expected to score based upon where the ball goes and other current game information, and we can then compare these predictions to the actual runs scored for different batters. I will do this in R. To begin with, lets load in the packages that we require.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I will use ball by ball data that has been put together by <a href="https://twitter.com/hganjoo_153">Himanish Ganjoo</a>. The dataset that I am using has been filtered so that it contains only the following:</p>
<ul>
<li>T20 Blast from 2015 to 2024 (to limit the size of the dataset but still have plenty of data for each player)</li>
<li>Matches played at the 18 major England and Wales stadiums (because some of the outgrounds that get used can have unusual dimensions)</li>
<li>Balls from outside the powerplay (because this causes the distribution of runs to vary significantly)</li>
<li>Balls that did not go for a boundary</li>
<li>Balls with wagonwheel data</li>
</ul>
<p>Loading this in and taking a look at it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"data.R"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="numouourgk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#numouourgk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#numouourgk thead, #numouourgk tbody, #numouourgk tfoot, #numouourgk tr, #numouourgk td, #numouourgk th {
  border-style: none;
}

#numouourgk p {
  margin: 0;
  padding: 0;
}

#numouourgk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#numouourgk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#numouourgk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#numouourgk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#numouourgk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#numouourgk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#numouourgk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#numouourgk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#numouourgk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#numouourgk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#numouourgk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#numouourgk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#numouourgk .gt_spanner_row {
  border-bottom-style: hidden;
}

#numouourgk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#numouourgk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#numouourgk .gt_from_md > :first-child {
  margin-top: 0;
}

#numouourgk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#numouourgk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#numouourgk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#numouourgk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#numouourgk .gt_row_group_first td {
  border-top-width: 2px;
}

#numouourgk .gt_row_group_first th {
  border-top-width: 2px;
}

#numouourgk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#numouourgk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#numouourgk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#numouourgk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#numouourgk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#numouourgk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#numouourgk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#numouourgk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#numouourgk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#numouourgk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#numouourgk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#numouourgk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#numouourgk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#numouourgk .gt_left {
  text-align: left;
}

#numouourgk .gt_center {
  text-align: center;
}

#numouourgk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#numouourgk .gt_font_normal {
  font-weight: normal;
}

#numouourgk .gt_font_bold {
  font-weight: bold;
}

#numouourgk .gt_font_italic {
  font-style: italic;
}

#numouourgk .gt_super {
  font-size: 65%;
}

#numouourgk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#numouourgk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#numouourgk .gt_indent_1 {
  text-indent: 5px;
}

#numouourgk .gt_indent_2 {
  text-indent: 10px;
}

#numouourgk .gt_indent_3 {
  text-indent: 15px;
}

#numouourgk .gt_indent_4 {
  text-indent: 20px;
}

#numouourgk .gt_indent_5 {
  text-indent: 25px;
}

#numouourgk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#numouourgk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="p_match" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p_match</th>
<th id="inns" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">inns</th>
<th id="over" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">over</th>
<th id="ball" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ball</th>
<th id="p_bat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p_bat</th>
<th id="p_nonstriker_bat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p_nonstriker_bat</th>
<th id="ground" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ground</th>
<th id="bat_hand" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">bat_hand</th>
<th id="bowl_kind" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">bowl_kind</th>
<th id="balls_rem" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">balls_rem</th>
<th id="wagonX" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">wagonX</th>
<th id="wagonY" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">wagonY</th>
<th id="score_minus_wides_and_noballs" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">score_minus_wides_and_noballs</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">7</td>
<td class="gt_row gt_right" headers="ball">2</td>
<td class="gt_row gt_right" headers="p_bat">17185</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">232435</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">LHB</td>
<td class="gt_row gt_left" headers="bowl_kind">pace bowler</td>
<td class="gt_row gt_right" headers="balls_rem">83</td>
<td class="gt_row gt_right" headers="wagonX">102</td>
<td class="gt_row gt_right" headers="wagonY">83</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">7</td>
<td class="gt_row gt_right" headers="ball">3</td>
<td class="gt_row gt_right" headers="p_bat">232435</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">17185</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">RHB</td>
<td class="gt_row gt_left" headers="bowl_kind">pace bowler</td>
<td class="gt_row gt_right" headers="balls_rem">82</td>
<td class="gt_row gt_right" headers="wagonX">119</td>
<td class="gt_row gt_right" headers="wagonY">101</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">7</td>
<td class="gt_row gt_right" headers="ball">4</td>
<td class="gt_row gt_right" headers="p_bat">17185</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">232435</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">LHB</td>
<td class="gt_row gt_left" headers="bowl_kind">pace bowler</td>
<td class="gt_row gt_right" headers="balls_rem">81</td>
<td class="gt_row gt_right" headers="wagonX">232</td>
<td class="gt_row gt_right" headers="wagonY">192</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">7</td>
<td class="gt_row gt_right" headers="ball">5</td>
<td class="gt_row gt_right" headers="p_bat">232435</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">17185</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">RHB</td>
<td class="gt_row gt_left" headers="bowl_kind">pace bowler</td>
<td class="gt_row gt_right" headers="balls_rem">80</td>
<td class="gt_row gt_right" headers="wagonX">309</td>
<td class="gt_row gt_right" headers="wagonY">180</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">7</td>
<td class="gt_row gt_right" headers="ball">6</td>
<td class="gt_row gt_right" headers="p_bat">232435</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">17185</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">RHB</td>
<td class="gt_row gt_left" headers="bowl_kind">pace bowler</td>
<td class="gt_row gt_right" headers="balls_rem">79</td>
<td class="gt_row gt_right" headers="wagonX">201</td>
<td class="gt_row gt_right" headers="wagonY">125</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="p_match">804447</td>
<td class="gt_row gt_right" headers="inns">1</td>
<td class="gt_row gt_right" headers="over">8</td>
<td class="gt_row gt_right" headers="ball">1</td>
<td class="gt_row gt_right" headers="p_bat">232435</td>
<td class="gt_row gt_right" headers="p_nonstriker_bat">17185</td>
<td class="gt_row gt_left" headers="ground">Riverside Ground, Chester-le-Street</td>
<td class="gt_row gt_left" headers="bat_hand">RHB</td>
<td class="gt_row gt_left" headers="bowl_kind">spin bowler</td>
<td class="gt_row gt_right" headers="balls_rem">78</td>
<td class="gt_row gt_right" headers="wagonX">230</td>
<td class="gt_row gt_right" headers="wagonY">198</td>
<td class="gt_row gt_right" headers="score_minus_wides_and_noballs">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Lets visualise this wagonwheel data, using different colours to denote the number of runs ran, and splitting it by batter and bowler types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_minus_wides_and_noballs =</span> <span class="fu">factor</span>(score_minus_wides_and_noballs)) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span>wagonX,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> wagonY,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> score_minus_wides_and_noballs</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(bowl_kind <span class="sc">~</span> bat_hand) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"#00FFFF"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"No. of runs"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>), <span class="co"># Increase spacing between facets</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/eda-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These wagonwheels all look as expected - dots where the ball does not go far from the bat, singles to the edge of the ring or close to the boundary, 2s appearing for some balls that go close to the boundary and the occasional 3 for a ball that goes close to the boundary.</p>
<p>Now lets think about building the model, and what variables I should include to predict how many runs were ran. I have decided upon the following:</p>
<ul>
<li>wagonX and wagonY (obviously)</li>
<li>Ground (grounds can vary in size, which means that smaller grounds will have less twos)</li>
<li>Bowler Type (since I don’t have fielding data, this helps give a proxy of where the fielders are positioned)</li>
<li>Batter Type (this also helps gives a proxy of what the field is like)</li>
<li>Innings Balls Remaining (towards the later stages of an innings, batters will take more risks)</li>
</ul>
<p>I will use a random forest model, using the <a href="https://cran.r-project.org/web/packages/randomForest/index.html">randomForest</a> package in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>runs_between_wickets_model_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"models"</span>, <span class="st">"runs_between_wickets_model.rds"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(runs_between_wickets_model_file)) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  runs_between_wickets_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    score_minus_wides_and_noballs <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      wagonX <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      wagonY <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      ground <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      bowl_kind <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      bat_hand <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      balls_rem,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> t20_bbb_for_model,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntree =</span> <span class="dv">100</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="dv">3</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesize =</span> <span class="dv">20</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(runs_between_wickets_model, runs_between_wickets_model_file)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  runs_between_wickets_model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(runs_between_wickets_model_file)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in randomForest.default(m, y, ...): The response has five or fewer
unique values.  Are you sure you want to do regression?</code></pre>
</div>
</div>
<p>I now want to check that this model is giving us sensible predictions. I’ll create a wagonwheel plot similar to before, but this time for the predicted values from my model rather than the actual number of runs ran.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>t20_bbb_for_model <span class="ot">&lt;-</span> t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">pmax</span>(<span class="fu">pmin</span>(<span class="fu">as.numeric</span>(<span class="fu">predict</span>(runs_between_wickets_model)), <span class="dv">3</span>), <span class="dv">0</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span>wagonX, <span class="at">y =</span> wagonY, <span class="at">color =</span> pred)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(bowl_kind <span class="sc">~</span> bat_hand) <span class="sc">+</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"#00FFFF"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Prediction"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),  <span class="co"># Increase spacing between facets</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/analyse predictions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’m really impressed with the detail that this model picks up. The graphs make a lot of intuitive sense to anyone who knows T20 cricket for a variety of reasons:</p>
<ul>
<li>You can make out where the boundary fielders usually are by the density of yellow compared to blue (meaning that the ball was hit to the fielder and a single was ran rather than into the gap and two runs were completed), particuarly for the spinners - three on the leg side and two on the off.</li>
<li>You can also make out fielding positions that will always be in the ring rather than on the boundary, for example backward point and extra cover.</li>
<li>The deep third man/deep fine leg positions score a lot more highly for spin compared to pace, which is because there very rarely is a fielder on the boundary behind square for spinners.</li>
</ul>
<p>So, given that we’re happy with the model, lets see the results! Which batters score a lot more runs than expected? The interactive table below allows you to see the number of extra runs that a batter achieves based upon where they hit the ball and the state of the game compared to an average batter, for those who appear at least 100 times in my data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_bat)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(p_bat, score_minus_wides_and_noballs, pred) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">player_id =</span> p_bat),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    t20_bbb_for_model <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_nonstriker_bat)) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(p_nonstriker_bat, score_minus_wides_and_noballs, pred) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">player_id =</span> p_nonstriker_bat)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_id) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">number =</span> <span class="fu">n</span>(),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">extra_run_ave =</span> <span class="fu">mean</span>(score_minus_wides_and_noballs <span class="sc">-</span> pred)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(players_df, <span class="at">by =</span> <span class="st">"player_id"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>results_df <span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(number <span class="sc">&gt;=</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(extra_run_ave)) <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(player_name, extra_run_ave) <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Name"</span>, <span class="st">"Runs above average"</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="st">"extra_run_ave"</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5abdd0e14ba6b76f44ae" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5abdd0e14ba6b76f44ae">{"x":{"filter":"none","vertical":false,"data":[["Zafar Ansari","Hardus Viljoen","James Foster","AB de Villiers","Tom Poynton","Mark Stoneman","Brydon Carse","Zak Crawley","Scott Borthwick","Anuj Dal","Paul Coughlin","Alex Hughes","Varun Chopra","Joe Leach","Calum MacLeod","Ian Holland","Joe Denly","Mark Wallace","Ryan ten Doeschate","Hamish Marshall","Jordan Clark","Haider Ali","Dan Lincoln","Daniel Bell-Drummond","Heino Kuhn","Dan Lawrence","Charlie Allison","Steven Davies","Colin de Grandhomme","James Weighell","Jos Buttler","Ben Raine","James Faulkner","Alviro Petersen","Will Rhodes","Alexei Kervezee","Tom Wells","Sean Abbott","Ashwell Prince","Bas de Leede","Alex Carey","Ryan McLaren","Kevin O'Brien","Phil Mustard","Aaron Thomason","Matthew Lamb","Graham Wagg","Liam Plunkett","Jonathan Tattersall","Alex Blake","Jimmy Adams","Chris Benjamin","Jake Libby","Tawanda Muyeye","Chris Morris","Chris Woakes","Adam Wheater","Daryl Mitchell","Geraint Jones","Stephen Eskinazi","Adam Hose","Neil Broom","Sean Dickson","James Fuller","Jesse Ryder","James Taylor","Fabian Cowdrey","Ned Eckersley","Arron Lilley","Ed Barnard","John Simpson","Ollie Pope","Marcus Stoinis","Luis Reece","James Franklin","Luke Wright","Andrew Gale","Alex Lees","Jacques Rudolph","Scott Steel","Grant Elliott","Dane Vilas","Michael Richardson","Finn Allen","Liam Dawson","Liam Trevaskis","Neil Dexter","Leus du Plooy","Brooke Guest","Gareth Berg","Ryan Davies","Michael Pepper","Daryl Mitchell","Ross Taylor","Tom Alsop","Aaron Finch","Ashton Agar","Cameron Bancroft","Nick Gubbins","Babar Azam","Fynn Hudson-Prentice","Shan Masood","Paul Horton","Rob Jones","Rory Burns","Harry Swindells","Toby Roland-Jones","Luke Procter","Harry Came","Sam Billings","Paul Collingwood","Chesney Hughes","Ravi Bopara","James Hildreth","Eddie Byrom","Ashton Turner","Alex Davies","Phil Salt","George Rhodes","Keaton Jennings","Joe Weatherley","Peter Handscomb","Alex Thomson","Carlos Brathwaite","Matt Machan","Dan Mousley","Matthew Waite","Tom Abell","Lewis McManus","Karl Brown","David Willey","Jeetan Patel","Moises Henriques","Brett D'Oliveira","Jack Leaning","Ollie Robinson","Niall O'Brien","Jamie Overton","Jason Roy","Tom Curran","Wes Durston","George Bailey","Scott Elstone","Ateeq Javid","Cameron Delport","Jonny Bairstow","Will Fraine","Adam Lyth","Lewis Hill","Daren Sammy","George Scott","Nathan McAndrew","Michael Klinger","Jack Haynes","Ashar Zaidi","Aneurin Donald","Mitchell Santner","Sean Ervine","Matt Henry","Chris Cooke","Dom Sibley","Mattie McKiernan","William Porterfield","Robin Das","Craig Cachopa","Rilee Rossouw","Craig Overton","Brendon McCullum","Tom Westley","Tom Cooper","Ben Cox","Will Smith","Luke Wood","Justin Broad","Mark Pettini","Tom Lammonby","Max Holden","Tom Hartley","Steven Croft","Ryan Pringle","Kieran Noema-Barnett","Tom Wood","Colin Ackermann","Sam Hain","Wayne Madsen","Jack Burnham","Gordon Muchall","Kyle Abbott","Daryn Smit","Stuart Poynter","Farhaan Behardien","Chris Nash","Eoin Morgan","Graham Clark","Roelof van der Merwe","Rikki Clarke","Martin Andersson","Tom Latham","Gary Wilson","Toby Albert","Dean Elgar","Nathan Sowter","James Vince","Feroze Khushi","Chris Dent","Simon Harmer","Sam Curran","Henry Brookes","Jordan Cox","Ben Mike","Ben Brown","Ben Foakes","Colin Munro","Billy Root","Adam Voges","Nathan Smith","Laurie Evans","Gareth Roderick","David Lloyd","Tom Banton","Hamish Rutherford","Gareth Batty","Lewis Gregory","Harry Dearden","Chris Wood","Billy Godleman","Ben Stokes","Joe Root","Mohammad Rizwan","Rob Yates","Michael Jones","Liam Livingstone","John Hastings","David Wiese","Jofra Archer","Cam Fletcher","Josh Davey","Sam Northeast","Tom Prest","Jamie Smith","Jake Lintott","Shiv Thakor","Kiran Carlson","Tom Kohler-Cadmore","Matthew Revis","Tom Taylor","Shahid Afridi","Ian Bell","Richard Oliver","George Garton","Nic Maddinson","Colin Ingram","Emilio Gay","Josh Inglis","Craig Meschede","Corey Anderson","Ben Dwarshuis","Shaun Marsh","Mark Cosgrove","Benny Howell","Matt Critchley","Paul Walter","Kumar Sangakkara","Aadil Ali","Rob Keogh","James Bracey","Johann Myburgh","Ben McDermott","Martin Guptill","Darren Stevens","Sikandar Raza","Grant Stewart","David Bedingham","Ethan Brookes","Travis Head","Shadab Khan","James Neesham","Danny Briggs","Alex Wakely","Marnus Labuschagne","Louis Kimber","Saif Zaib","Nick Welch","Joe Cracknell","Ed Pollock","Rehan Ahmed","Dan Christian","Tom Helm","Miles Hammond","Ben Green","Peter Trego","Michael Burgess","Graeme White","Callum Ferguson","Owais Shah","Paul Stirling","James Coles","Lewis Goldsworthy","Matthew Hurst","Delray Rawlins","Kane Williamson","Chris Jordan","Rishi Patel","Tim David","Mohammad Nabi","Dawid Malan","Glenn Maxwell","Dwayne Bravo","Azhar Mahmood","Chris Green","Luc Benkenstein","Imad Wasim","Mason Crane","Tim Ambrose","Daniel Sams","Ian Cockbain","Max Waller","Tim Bresnan","Harry Brook","Will Smeed","Moeen Ali","Andrew Salter","Andy Balbirnie","Joey Evison","Ben Curran","Brendan Taylor","George Linde","Sunil Narine","Hashim Amla","Greg Smith","Joe Clarke","Ollie Robinson","Harrison Ward","Steven Mullaney","D'Arcy Short","Glenn Phillips","Luke Hollman","Devon Conway","Riki Wessels","Matt Taylor","Wiaan Mulder","Michael Carberry","Will Jacks","James Wharton","Steven Crook","Gary Ballance","Ross Whiteley","Wayne Parnell","Andrew Tye","Matthew Potts","Pieter Malan","Jack Davies","Tom Clark","Harry Finch","Matthew Breetzke","Jordan Thompson","Alex Hales","Kashif Ali","Ricardo Vasconcelos","Chris Lynn","Zak Chappell","Danny Lamb","Nick Selman","Cameron Steel","Jack Taylor","Ben Duckett","Richard Levi","Jacob Bethell","Umar Akmal","Seekkuge Prasanna","Joshua De Caires","Will Beer","Tom Bruce","Tom Moores","Oliver Price","Matthew Montgomery","Lyndon James","Ryan Higgins","Adam Rossington","Rory Kleinveldt","Samit Patel","Jim Allenby","Josh Cobb","David Payne","Callum Parkinson","Beau Webster","Daniel Hughes","Usman Arshad","Mathew Pillans","Callum Taylor","Timm van der Gugten","Donovan Ferreira","Luke Wells","Graeme van Buuren","George Hill","Dom Bess","Marchant de Lange","Ben Charlesworth","Luke Ronchi","Zafar Gohar","Tom Sole","Dan Douthwaite","Tom Smith","Mahela Jayawardene","Dwaine Pretorius","Liam Patterson-White","Matthew Carter","William Buttleman","Olly Stone","Calvin Harrison","Luke Fletcher","Shane Snater","Ben Sanderson","Chris Gayle"],[0.1163516601276632,0.1155741846649561,0.1069998916048167,0.100556951749676,0.09144266679122168,0.08932890774549623,0.08628050478796721,0.07996361893144106,0.07695631345719926,0.07598745148935249,0.0746727624641453,0.07294086257135643,0.06870999472693402,0.06680057090579644,0.06642087631985941,0.06573509824443394,0.06478340283230563,0.06457754089222288,0.06454205540814865,0.06447104416553229,0.06388791060865241,0.06365599144710608,0.06295067140273473,0.06198625774740561,0.06170300357234684,0.06157667635680435,0.06148803232609681,0.0597046365287669,0.05882621302284024,0.05859579026185206,0.05826101694786096,0.0578052123958851,0.05595110995074582,0.05445222865896288,0.0541518401017239,0.05293441125873362,0.04840356952616706,0.04704601267663663,0.04584097290299213,0.04577457714063848,0.04574756414401707,0.04557010028631413,0.04474745836203955,0.04440814998118228,0.04424545285336272,0.0442387204818965,0.04397474372596676,0.04346959078108904,0.04210041576119902,0.04182110880823799,0.04178728731748459,0.04156325889287125,0.04104238291337668,0.0402598466195198,0.03898527995762145,0.03765060764373045,0.03717896337849257,0.03598667579517259,0.03593350600994985,0.03579715342953094,0.03577732989715718,0.03554322551872529,0.0348870612645444,0.03433284472129167,0.03333568809616975,0.03306897387733134,0.03139256128883709,0.03111200503241334,0.03105247803781206,0.02947232504150597,0.02917079531868918,0.02906084712711905,0.02879936096409692,0.02878000037662688,0.02840436260798302,0.02776326978454644,0.02755980293313898,0.02749428763096986,0.02703074296477808,0.02678552721700219,0.02645532548504628,0.0263577192819803,0.02628269263813367,0.02551904651749636,0.02540883402622545,0.02435909889747712,0.02427596314981671,0.02350940355084255,0.02309782795207059,0.02236809801382799,0.02216512445276626,0.02133852296202867,0.02095261806586966,0.02076635357771152,0.02069816421583424,0.02065796757705292,0.02054877727532826,0.02053651676048095,0.02051565530224586,0.02030578895030518,0.01996662912831372,0.01977584149584648,0.01943241906334429,0.0194116647437233,0.01895535201268076,0.0187580309881078,0.01859291146603428,0.01830384409039541,0.01829352651354848,0.01731486281203961,0.01727959671922626,0.01725279178576398,0.01720820737023629,0.01671068649557692,0.01658472293650328,0.01651212553832395,0.01633721959260059,0.0162748409897456,0.0161956901497476,0.01605612917860901,0.01581014029570081,0.01562650448879602,0.01543356709632814,0.0153915062063843,0.01530323358337034,0.0151126119103604,0.01510507283094561,0.01486502802180819,0.01480688130302572,0.01438652700496539,0.01423468039750565,0.01416271790072943,0.01403927626845992,0.01397852271156874,0.01381354589418434,0.01370529058597797,0.01364850721231045,0.0135866991801877,0.01340611275015833,0.01273592685520946,0.0122010015435278,0.01209713988871284,0.01207284011832922,0.01191259196439838,0.01109781372054621,0.0108880680566371,0.01051201301906053,0.01049640472184958,0.01029484030213785,0.01025583311992329,0.01020823881340241,0.01017318504360025,0.01006612386381564,0.009534746862957875,0.008931135568613828,0.008612882268310373,0.008033906765736502,0.007944516305691679,0.007730108374076819,0.007595144317058856,0.007450753830571726,0.007076367859156453,0.006947433062549315,0.006926852303888437,0.006915270404812842,0.006533363160915091,0.006447409904625555,0.005792494409649165,0.005758893099937369,0.0056644696890253,0.005623699043123694,0.005615965483708988,0.005151640064254073,0.004998052961653858,0.004781371798291903,0.004733956147545381,0.004574493053694132,0.0042734394332249,0.003787495283922909,0.002966899255544173,0.002911137752458953,0.002860034899185524,0.002549181551670914,0.002510426810385765,0.002475267883075755,0.001920943236558344,0.001836322484879079,0.001736336780707709,0.001564099781743278,0.001525423638416282,0.001364692262684265,0.001326226088593981,0.001054846025540041,0.0008492240468362507,0.0007986168545873723,0.000736923949585485,7.700476608264926e-05,-0.0005894197931458813,-0.001653300014572734,-0.002007407929403013,-0.002262916651562198,-0.002390065072836286,-0.002591494086446494,-0.002923828814113885,-0.003274630272847215,-0.003586243723308533,-0.004447787083038814,-0.004730928798081164,-0.004801782790699482,-0.005162398086924366,-0.005225543843054212,-0.005346659497326847,-0.005586772102164907,-0.005862630638834065,-0.006100998255404082,-0.006199428963233753,-0.006331829381967564,-0.006351847876392936,-0.006739136504644728,-0.006980818530778737,-0.007135127167885428,-0.00716644578479252,-0.007940453485828855,-0.008232356758200568,-0.008497187606634317,-0.008952526280632431,-0.009528959565542418,-0.0095836079580032,-0.01058805083376604,-0.01084931174009902,-0.01102589098747181,-0.0115563039645651,-0.0115699477855169,-0.01175773960503521,-0.01179679004280974,-0.01194134259527365,-0.01219237081095523,-0.01254861750876375,-0.01317543086467045,-0.01352498596102705,-0.01356970327519976,-0.01385412291293727,-0.01553906021374127,-0.01568964933191569,-0.01646653989727893,-0.01678424906365232,-0.01698417130827135,-0.0170352300859305,-0.01808065345255532,-0.01814903277390917,-0.01877218527414955,-0.01879109978044627,-0.0199347901214248,-0.02015360193793933,-0.02044748254248564,-0.02058882338827607,-0.02078473227426548,-0.02155022161676006,-0.02196300560408707,-0.0224230255446384,-0.02243599176116859,-0.02279180722004126,-0.02291271617695391,-0.02347192038990472,-0.023603198647934,-0.02363688443264159,-0.02392164995437946,-0.02433249907277426,-0.02433926531964597,-0.02478515747815642,-0.02499873192306777,-0.02515624837527787,-0.02515692403115118,-0.02531167439092404,-0.02532931257321668,-0.02533901929580689,-0.02564810647678124,-0.02578823756823648,-0.02634720741630513,-0.02683851701990122,-0.02687260489893453,-0.02695955561000899,-0.02721935535840774,-0.02722446733666129,-0.02752664097887226,-0.02770339534513656,-0.02797490815640494,-0.02804230811818268,-0.02875419548627521,-0.02879257130404609,-0.03002626930793369,-0.03006769063546362,-0.03011073998966545,-0.03051382163642177,-0.03077297579748721,-0.03100813466509359,-0.03102156828969062,-0.03138547332125392,-0.03154288797968401,-0.03206599636744617,-0.03214237936025122,-0.03225611188953893,-0.0322856887582779,-0.03245909490697512,-0.03252591246760771,-0.03253261118482267,-0.03257784859762731,-0.03279778273786157,-0.0341253752385168,-0.03433861671780658,-0.03452765088088324,-0.03471072123688134,-0.03498278383161227,-0.03513515387503394,-0.03544017447359932,-0.03544164005536905,-0.03562971594508597,-0.03626040815526282,-0.03733909676383838,-0.03740965476353572,-0.03774206439192786,-0.03775202502369988,-0.0390615581503717,-0.03907275775613369,-0.03924338852599962,-0.03927208947651449,-0.03937160000888551,-0.04016150419040741,-0.04049789368249258,-0.04133897271684889,-0.04162212691302515,-0.04192202968697914,-0.04207137692686674,-0.04315134026381157,-0.04328962142252889,-0.04367067034827632,-0.04372001574613382,-0.04404466632883226,-0.04433812181372144,-0.04440384615576303,-0.04444839764876068,-0.04460928407863136,-0.04465992067910231,-0.04513665287790942,-0.04605698421784281,-0.04611388233538413,-0.04630495561109982,-0.04757036999876723,-0.04760145038823729,-0.04793979690452593,-0.04799943568050508,-0.04806759116396415,-0.04992584359005994,-0.04994691467472979,-0.05020989970814538,-0.05044353424157276,-0.05046578963755952,-0.05112767086031186,-0.05147790750220844,-0.0524202560884164,-0.05277938932449774,-0.05306433978747839,-0.05476324610998737,-0.05490551861784614,-0.05652712706743969,-0.05672577668126875,-0.0582531055290624,-0.05841310809829894,-0.05943151719827344,-0.05994114888886513,-0.06035287522461743,-0.06132835909231982,-0.06323124089752054,-0.06336974043893816,-0.06526362988585457,-0.06554868296592888,-0.06629601263868552,-0.06645333701279096,-0.06814015564618899,-0.06968638820394052,-0.07048783028303293,-0.07070645851278635,-0.0708009818042081,-0.07086209746216351,-0.07099617877502817,-0.07244078683935148,-0.07301085269289076,-0.07318184579015481,-0.07348194734692524,-0.07488240612290031,-0.07598558702911974,-0.0801264729842902,-0.08038088869187347,-0.08109804362229849,-0.08165067428378919,-0.08238507404656759,-0.08458897164013446,-0.08686022305687094,-0.08697652015386388,-0.08981289296166955,-0.09627058601559756,-0.103122288022641,-0.1033356944047183,-0.1057899237565431,-0.1180184251997677,-0.1181210024607185,-0.121127375213356,-0.1255377333953794,-0.1268051916961685,-0.1295188835634934,-0.1363583090274127,-0.1556515374916691,-0.1626430946750248,-0.1703635419977195]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Name<\/th>\n      <th>Runs above average<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<p>We see Zafar Ansari and Hardus Viljoen on top according to my model. Each ball that they are in for that doesn’t go to the boundary, more than 0.11 runs are scored than expected, meaning that for every 9 non boundary balls that they are in for one extra run is scored compared to an average batter. What about those who do a lot worse than expected? Simply click on the “Runs above average” word to arrange the table in ascending order.</p>
<p>Seeing Chris Gayle with the lowest runs above average is unsurprising and gives me confidence that this model is working as expected. Note that the coefficients for the worst runners are further away from 0 than the coefficients for the quickest runners, which means that there are more batters that have a detrimental rather than positive impact with their running between the wickets.</p>
<p>Given our analysis, can we say how many extra runs a particular batter contributes because of their running? On average, a top order batter is in for 33 non boundary deliveries (that they and their partner face) during an innings. This means that the fastest runners between the wickets contribute up to 3 extra runs on average to their teams innings, whereas someone like Chris Gayle causes the team to score 5.5 less runs compared to an average player because of his running between the wickets.</p>
<p>Whilst we have quantified the number of runs that each batter will directly contribute through their running ability, there are also indirect effects of running ability that haven’t been quantified: a batter can feel pressure if they are struggling to rotate the strike leading to them and potentially their partner too being more likely to lose their wicket on a future delivery. Also from my experience of watching cricket, a team are more likely to be let down if one batter is slow rather than benefitting from one batter being fast - the time it takes to complete a run will only be as quick as the slowest of the two runners.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/bfern\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>